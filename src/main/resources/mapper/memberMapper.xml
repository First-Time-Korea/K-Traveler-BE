<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.firskorea.member.mapper.MemberMapper">

	<!-- 회원 가입하기 -->
	<insert id="signUp" parameterType="memberDto">
		insert into member (id, name, password, email_id, email_domain, status, join_date)
		values (#{id}, #{name}, #{password}, #{emailId}, #{emailDomain}, 1 ,now());
	</insert>
	
	<!-- 회원 ID 중복성 체크하기 -->
	<select id="checkDuplicationUserId" parameterType="string" resultType="int">
		select count(*) from member
		where id = #{userId}
	</select>

	<!-- 로그인하기 -->
	<select id="login" parameterType="memberDto" resultType="memberDto">
		select id, name, status existedOfMember, token
		from member
		where id = #{id}
		and password = #{password}
	</select>

	<!-- refresh token 저장하기 -->
	<update id="saveRefreshToken" parameterType="map">
		update member
		set token = #{token}
		where id = #{userId}
	</update>
	
	<!-- refresh token 삭제하기 -->
	<update id="deleteRefreshToken" parameterType="string">
		update member
		set token = null
		where id = #{userId}
	</update>

	<!-- 회원 정보 조회하기 -->
	<select id="getUserInfo" parameterType="string" resultType="memberDto">
		select name, id, email_id, email_domain, join_date
		from member
		where id = #{userId}
	</select>

	<!-- refresh token 조회하기 -->
	<select id="getRefreshToken" parameterType="string" resultType="string">
		select token
		from member
		where id = #{userId}
	</select>
	
	<!-- 회원 탈퇴하기 -->
	<update id="deleteUser" parameterType="string">
		update member
		set status = 0, token = null
		where id = #{userId}
	</update>

</mapper>